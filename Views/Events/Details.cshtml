@model MovieEventBooking.Models.EventModel
@{
    ViewData["Title"] = "Book Event";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

<div class="container py-5">
    <div class="card shadow-lg mx-auto p-4" style="max-width:700px; border-radius:20px; background-color:#141b29; color:white;">
        <img src="@Model.PosterUrl" class="card-img-top mb-3" style="height:250px; object-fit:cover; border-radius:15px;">
        <h3 class="text-center text-warning">@Model.Title</h3>
        <p class="text-center">@Model.Description</p>
        <p class="text-center">Genre: @Model.Genre | Duration: @Model.Duration</p>
        <p class="text-center fw-bold">Price: ₹@Model.Price per ticket</p>

        <hr class="text-secondary" />

        <h5 class="text-warning"> Enter Your Name</h5>
        <input id="userNameInput" type="text" class="form-control mb-3" placeholder="Full Name" />

        <h5 class="text-warning"> Select Date</h5>
        <input id="eventDate" type="date" class="form-control mb-3" />

        <h5 class="text-warning"> Choose Seats</h5>
        <div id="seatGrid" class="d-flex flex-wrap gap-2 mb-3">
            @foreach (var seat in Model.Seats)
            {
                bool booked = seat.Contains("X");
                <button class="seat-btn @(booked ? "booked" : "available")" @(booked ? "disabled" : "")>@seat.Replace("X", "")</button>
            }
        </div>

        <h5 class="text-warning"> Payment Method</h5>
        <select id="paymentMethod" class="form-select mb-3">
            <option>Cash on Event</option>
            <option>UPI Payment</option>
            <option>Debit/Credit Card</option>
            <option>Net Banking</option>
        </select>

        <form id="bookingForm" asp-controller="Events" asp-action="Book" method="post">
            <input type="hidden" name="EventId" value="@Model.EventId" />
            <input type="hidden" name="SelectedSeats" id="selectedSeatsInput" />
            <input type="hidden" name="UserName" id="hiddenUserName" />
            <input type="hidden" name="Date" id="hiddenDate" />
            <input type="hidden" name="PaymentMethod" id="hiddenPayment" />
            <button type="submit" class="btn btn-warning w-100 fw-bold">Confirm Booking</button>
        </form>
    </div>
</div>

<style>
    .seat-btn {
        width: 50px;
        height: 50px;
        border-radius: 8px;
        border: none;
        font-weight: bold;
        color: white;
        transition: 0.2s;
    }

    .available {
        background-color: #1abc9c;
    }

        .available:hover {
            background-color: #16a085;
            transform: scale(1.1);
        }

    .booked {
        background-color: #e74c3c;
    }

    .selected {
        background-color: #f1c40f;
        color: black;
    }
</style>

<script>
    const seats = document.querySelectorAll(".seat-btn.available");
    seats.forEach(btn => {
        btn.addEventListener("click", ()=>{
            btn.classList.toggle("selected");
        });
    });

    document.getElementById("bookingForm").addEventListener("submit", function(e){
        const selectedSeats = Array.from(document.querySelectorAll(".seat-btn.selected")).map(b=>b.textContent).join(",");
        if(selectedSeats.length === 0){
            alert("Select at least one seat!");
            e.preventDefault(); return;
        }

        const userName = document.getElementById("userNameInput").value.trim();
        const date = document.getElementById("eventDate").value;
        const payment = document.getElementById("paymentMethod").value;

        if(!userName || !date){
            alert("Enter name and date!");
            e.preventDefault(); return;
        }

        document.getElementById("selectedSeatsInput").value = selectedSeats;
        document.getElementById("hiddenUserName").value = userName;
        document.getElementById("hiddenDate").value = date;
        document.getElementById("hiddenPayment").value = payment;
    });
</script>
